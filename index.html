<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ligue Warzone ‚Äì Classement & Journ√©es</title>
  <meta name="description" content="Site gratuit et simple pour pr√©senter une ligue Warzone : classement, journ√©es (Masters Kills), joueurs et r√®glement." />
  <style>
    :root{ --bg:#0f1115; --card:#151924; --muted:#8b98a5; --text:#e7edf3; --accent:#6dd3ff; --accent2:#9b8cff; --ok:#36d399; --warn:#fbbf24; --bad:#ef4444; --border:#202636; }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Helvetica,Arial,sans-serif;background:linear-gradient(180deg,#0e1014 0%,#0f1115 40%,#0a0c10 100%);color:var(--text);}
    a{color:var(--accent)} .wrap{max-width:1100px;margin:0 auto;padding:24px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:16px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:40px;height:40px;border-radius:12px;background:conic-gradient(from 140deg at 50% 50%,var(--accent),var(--accent2));display:grid;place-items:center;font-weight:800;color:#0a0c10}
    .title h1{font-size:24px;margin:0} .title p{margin:2px 0 0;color:var(--muted);font-size:13px}
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{background:var(--card);border:1px solid var(--border);padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600;color:#cfe6ff;opacity:.85}
    .tab.active,.tab:hover{outline:2px solid rgba(109,211,255,.25);opacity:1}
    .cards{display:grid;grid-template-columns:repeat(12,1fr);gap:14px;margin-top:16px}
    .card{grid-column:span 12;background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px}
    @media(min-width:800px){.card.half{grid-column:span 6}}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:10px}
    .input{background:#0c0f16;border:1px solid var(--border);padding:8px 10px;border-radius:10px;color:var(--text)}
    .btn{background:linear-gradient(180deg,#1f2a3c,#101625);color:#e8f1ff;border:1px solid var(--border);padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600}
    .btn.ghost{background:transparent} .btn:hover{filter:brightness(1.1)}
    table{width:100%;border-collapse:separate;border-spacing:0 10px} th,td{text-align:left;padding:10px}
    th{color:#b9c6d1;font-size:12px;letter-spacing:.6px;text-transform:uppercase;cursor:pointer;user-select:none}
    tbody tr{background:#121826;border:1px solid var(--border)}
    tbody tr td:first-child{border-top-left-radius:12px;border-bottom-left-radius:12px}
    tbody tr td:last-child{border-top-right-radius:12px;border-bottom-right-radius:12px}
    .rank{width:38px;text-align:center;font-weight:800}
    .team{display:flex;align-items:center;gap:10px} .badge{width:28px;height:28px;border-radius:50%;display:grid;place-items:center;font-weight:800;color:#0a0c10}
    .match{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:#0f1421}
    .match + .match{margin-top:10px} .match .when{color:var(--muted);font-size:12px}
    .tag{font-size:11px;padding:4px 8px;border:1px solid var(--border);border-radius:8px;background:#0e1320;color:#cfe6ff}
    .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}
    .teamcard{border:1px solid var(--border);background:#111725;border-radius:14px;padding:12px}
    .teamcard h4{margin:8px 0 6px} .muted{color:var(--muted)}
    .played{ text-decoration: line-through; color: var(--bad); opacity:.9 }
    .eventcard{border:1px solid var(--border);background:#0f1421;border-radius:14px;padding:12px;display:flex;justify-content:space-between;align-items:center}
    .eventmeta{color:var(--muted);font-size:12px}
    footer{margin:22px 0;color:var(--muted);font-size:12px}
    .pill{display:inline-block;padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:#0f1421;color:#cfe6ff}
    .hide{display:none !important}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">WZ</div>
        <div class="title">
          <h1>Ligue Warzone</h1>
          <p>Classement, journ√©es (Masters Kills), joueurs & r√®glement</p>
        </div>
      </div>
      <nav class="tabs" role="tablist" aria-label="Navigation principale">
        <button class="tab active" data-tab="standings">Classement</button>
        <button class="tab" data-tab="fixtures">Journ√©es</button>
        <button class="tab" data-tab="calendar">Calendrier</button>
        <button class="tab" data-tab="players">Joueurs</button>
        <button class="tab" data-tab="rules">R√®glement</button>
      </nav>
    </header>

    <!-- CLASSEMENT -->
    <section class="card" id="standings" role="tabpanel">
      <div class="toolbar">
        <input id="searchTeam" class="input" placeholder="Rechercher un joueur‚Ä¶" />
        <span class="pill" id="seasonLabel">Saison 1</span>
        <span class="pill" id="lastUpdate">Derni√®re mise √† jour ‚Äî ‚Äî</span>
      </div>
      <table aria-label="Tableau du classement">
        <thead>
          <tr>
            <th data-sort="rank">#</th>
            <th data-sort="name">Joueur</th>
            <th data-sort="MJ" title="Journ√©es jou√©es">MJ</th>
            <th data-sort="KILLS" title="Kills cumul√©s">Kills</th>
            <th data-sort="Pts" title="Points (kills + bonus)">Pts</th>
          </tr>
        </thead>
        <tbody id="standingsBody"></tbody>
      </table>
    </section>

    <!-- JOURNEES -->
    <section class="card half" id="fixtures" role="tabpanel" hidden>
      <div class="toolbar">
        <button class="btn hide" id="addJournee">Ajouter une journ√©e</button>
        <button class="btn ghost hide" id="addEntry">Ajouter r√©sultats joueur</button>
        <button class="btn ghost hide" id="exportJSON">Exporter JSON</button>
        <input type="file" id="importJSON" accept="application/json" hidden>
        <button class="btn ghost hide" id="importBtn">Importer JSON</button>
      </div>
      <div id="journeesList"></div>
    </section>

    <!-- CALENDRIER -->
    <section class="card" id="calendar" role="tabpanel" hidden>
      <div class="toolbar">
        <button class="btn hide" id="addEvent">Ajouter une rencontre</button>
        <button class="btn ghost" id="togglePlayedView">Basculer: Tous ‚áÑ √Ä jouer</button>
      </div>
      <div id="calendarWrap" class="grid"></div>
      <p class="muted" style="margin-top:8px">Les rencontres <strong>jou√©es</strong> s‚Äôaffichent <span style="color:#ef4444">rouges</span> et <span style="text-decoration:line-through;color:#ef4444">barr√©es</span>. Cliquez sur une carte pour basculer son statut.</p>
    </section>

    <!-- JOUEURS -->
    <section class="card half" id="players" role="tabpanel" hidden>
      <div class="grid" id="playersGrid"></div>
    </section>

    <!-- R√àGLEMENT -->
    <section class="card" id="rules" role="tabpanel" hidden>
      <h3>R√®glement ‚Äì synth√®se (adapt√© Warzone)</h3>
      <ol>
        <li><strong>Participants.</strong> 15 joueurs. √Ä chaque journ√©e : 3 matchs (poules) de 4 joueurs, 3 joueurs exempt√©s. 5 manches par journ√©e.</li>
        <li><strong>Notation par journ√©e.</strong> Points journ√©e = Kills (5 manches) + Bonus (1er +60, 2e +40, 3e +20, 4e +10).</li>
        <li><strong>Classement g√©n√©ral.</strong> Somme des points de chaque journ√©e. √âgalit√©s : points > kills > ordre alphab√©tique.</li>
      </ol>
    </section>

    <footer class="wrap">Fait pour vous üíô ‚Äî mod√®le statique h√©bergeable (GitHub Pages, Netlify, Vercel).</footer>
  </div>

  <script>
    // === CONFIG ===
    const REMOTE_DATA_URL = "warzone.json"; // m√™me dossier que index.html
    const ADMIN_CODE = "WZ2025";
    const ADMIN_ON = (new URLSearchParams(location.search).get('admin') === ADMIN_CODE);

    // === √âTAT (pas de localStorage) ===
    const defaultState = { season:1, updatedAt:new Date().toISOString(), players:[], journees:[], events:[] };
    const state = JSON.parse(JSON.stringify(defaultState));
    function saveState(){ state.updatedAt = new Date().toISOString(); render(); } // jamais de cache local

    // === UTILS ===
    const bonusMap = {1:60,2:40,3:20,4:10};
    function fmtDate(iso){ const d=new Date(iso); if(isNaN(d)) return '‚Äî'; return d.toLocaleString('fr-FR',{dateStyle:'medium', timeStyle:'short'}); }
    function playerById(id){ return (state.players||[]).find(p=>p.id===id); }
    function showAdmin(){ document.querySelectorAll('.hide').forEach(el=>{ if(ADMIN_ON) el.classList.remove('hide'); }); }

   async function fetchRemote(){
  if(!REMOTE_DATA_URL) return;
  try{
    const res = await fetch(REMOTE_DATA_URL, { cache: 'no-store' });
    if(!res.ok) throw new Error('HTTP '+res.status);
    const obj = await res.json();
    if(obj.players) state.players = obj.players;
  if(obj.journees) {
  state.journees = mergeJourneesPlus(state.journees, obj.journees);
  // ‚õî filtre toute "journ√©e" TOTAL (ou id 99)
  state.journees = state.journees.filter(function(j){
    var lab = String(j.label || '').toUpperCase();
    return !(lab.includes('TOTAL') || j.id === 99);
  });
}

    if(obj.events) state.events = mergeEvents(state.events,obj.events);
    saveState();
  }catch(e){ console.warn('Sync distante ignor√©e:', e); }
}


    // === CLASSEMENT (Points = kills + bonus; on ignore e.points pour le calcul) ===
  function computeStandings(){
  const t = {};
  (state.players||[]).forEach(p => {
    t[p.id] = { id:p.id, name:p.name, color:p.color||'#6dd3ff', MJ:0, KILLS:0, Pts:0 };
  });

  (state.journees||[]).forEach(j => {
    // D√©duplique les entr√©es de la journ√©e : 1 par joueur
    const unique = new Map();
    (j.entries||[]).forEach(e => {
      if(!e || !e.player) return;
      unique.set(String(e.player).toUpperCase(), e); // garde la derni√®re occurrence
    });

    unique.forEach((e, pid) => {
      const row = t[pid];
      if(!row) return;

      const kills = Number.isFinite(+e.kills) ? +e.kills : 0;
      const bonus = Number.isFinite(+e.bonus)
        ? +e.bonus
        : (Number.isFinite(+e.rank) ? (bonusMap[+e.rank]||0) : 0);

      // Compte MJ seulement si la ligne n'est pas vide
      const played = (kills > 0) ||
                     (bonus > 0) ||
                     (Number.isFinite(+e.points) && +e.points > 0);
      if(!played) return;

      // PTS = kills + bonus (comme convenu)
      row.MJ    += 1;
      row.KILLS += kills;
      row.Pts   += (kills + bonus);
    });
  });

  return Object.values(t)
    .sort((a,b)=> (b.Pts-a.Pts) || (b.KILLS-a.KILLS) || a.name.localeCompare(b.name));
}


    // Tri dynamique
    let currentSort = {key:'Pts', dir:'desc'};
    function applySort(rows){
      const dir = currentSort.dir==='asc'? 1 : -1;
      return rows.slice().sort((a,b)=>{
        const ka=a[currentSort.key], kb=b[currentSort.key];
        if(typeof ka==='string' || typeof kb==='string') return dir * String(ka).localeCompare(String(kb));
        return dir * (ka-kb);
      });
    }

    function renderStandings(){
      const body=document.getElementById('standingsBody'); body.innerHTML='';
      const q=(document.getElementById('searchTeam').value||'').toLowerCase();
      let rows = computeStandings().filter(t=> t.name.toLowerCase().includes(q));
      rows = applySort(rows);
      rows.forEach((t,i)=>{
        const tr=document.createElement('tr');
        tr.innerHTML =
          '<td class="rank">'+(i+1)+'</td>'+
          '<td><div class="team"><div class="badge" style="background:'+t.color+'">'+t.id+'</div><strong>'+t.name+'</strong></div></td>'+
          '<td>'+t.MJ+'</td><td>'+t.KILLS+'</td><td><strong>'+t.Pts+'</strong></td>';
        body.appendChild(tr);
      });
      document.getElementById('seasonLabel').textContent='Saison '+state.season;
      document.getElementById('lastUpdate').textContent='Derni√®re mise √† jour ‚Äî '+fmtDate(state.updatedAt);
    }

    // === JOURN√âES (affiche exempt√©s) ===
    function renderFixtures(){
      const list=document.getElementById('journeesList'); if(!list) return; list.innerHTML='';
      const byDate=[].concat(state.journees||[]).sort((a,b)=> new Date(a.date)-new Date(b.date));
      byDate.forEach(j=>{
        const box=document.createElement('div'); box.className='match';
        const ex=(j.exempts||[]).join(', ')||'‚Äî'; const cnt=(j.entries||[]).length;
        box.innerHTML='<div><div class="when">'+fmtDate(j.date)+'</div><div class="tag">'+(j.label||'Journ√©e')+'</div></div>'+
                      '<div class="tag">Exempt: '+ex+'</div>'+
                      '<div class="tag">'+cnt+' r√©sultats</div>';
        list.appendChild(box);
      });
    }

    // === CALENDRIER ===
    let showOnlyUpcoming=false;
    function renderCalendar(){
      const wrap=document.getElementById('calendarWrap'); if(!wrap) return; wrap.innerHTML='';
      let items=[].concat(state.events||[]).sort((a,b)=> (a.j-b.j)||String(a.grp).localeCompare(String(b.grp)));
      if(showOnlyUpcoming) items = items.filter(e=>!e.played);
      if(!items.length){ wrap.innerHTML='<div class="muted">Aucune rencontre.</div>'; return; }
      let currentJ=null;
      items.forEach(ev=>{
        if(currentJ!==ev.j){ currentJ=ev.j; const h=document.createElement('h4'); h.textContent='Journ√©e '+currentJ; h.style.margin='10px 0 6px'; wrap.appendChild(h); }
        const card=document.createElement('div'); card.className='eventcard'+(ev.played?' played':'');
        const lineup=(ev.players||[]).join(', ');
        card.innerHTML='<div><div><strong>'+ev.title+(ev.grp?' ('+ev.grp+')':'')+'</strong></div>'+
                       '<div class="eventmeta">'+(lineup||'')+'</div></div>'+
                       '<div><span class="tag">'+(ev.played?'Jou√©e':'√Ä jouer')+'</span></div>';
        card.addEventListener('click', ()=>{ ev.played=!ev.played; renderCalendar(); }); // visuel uniquement
        wrap.appendChild(card);
      });
    }

    // === JOUEURS ===
    function renderPlayers(){
      const grid=document.getElementById('playersGrid'); if(!grid) return; grid.innerHTML='';
      (state.players||[]).forEach(p=>{
        const el=document.createElement('div'); el.className='teamcard';
        el.innerHTML='<div class="team">'+
          '<div class="badge" style="background:'+(p.color||'#6dd3ff')+'">'+p.id+'</div>'+
          '<div><h4>'+p.name+'</h4><div class="muted">ID: '+p.id+'</div></div>'+
          '</div>';
        grid.appendChild(el);
      });
    }

    // === RENDER ROOT ===
    function render(){ renderStandings(); renderFixtures(); renderCalendar(); renderPlayers(); }

    // === √âCOUTEURS ===
    document.querySelectorAll('.tab').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const id = btn.getAttribute('data-tab');
        document.querySelectorAll('section[role="tabpanel"]').forEach(s=> s.hidden = (s.id!==id));
      });
    });
    const searchEl=document.getElementById('searchTeam'); if(searchEl) searchEl.addEventListener('input', renderStandings);
    const tog=document.getElementById('togglePlayedView'); if(tog) tog.addEventListener('click', ()=>{ showOnlyUpcoming=!showOnlyUpcoming; renderCalendar(); });

    // Tri par colonnes
    document.querySelectorAll('th[data-sort]').forEach(th=>{
      th.addEventListener('click', ()=>{
        const key = th.getAttribute('data-sort');
        currentSort = (currentSort.key===key) ? {key, dir:(currentSort.dir==='asc'?'desc':'asc')} : {key, dir:'desc'};
        renderStandings();
      });
    });

    // === INIT ===
    showAdmin();
    fetchRemote();
  </script>
</body>
</html>
